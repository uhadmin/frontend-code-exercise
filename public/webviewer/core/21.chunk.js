/** Notice * This file contains works from many authors under various (but compatible) licenses. Please see core.txt for more information. **/
(function(){(window.wpCoreControlsBundle=window.wpCoreControlsBundle||[]).push([[21],{588:function(xa,ta,h){h.r(ta);var pa=h(0),qa=h(7),na=h(3);xa=h(58);var ja=h(34),ka=h(14);h=function(){function ha(){this.init()}ha.prototype.init=function(){this.$na=!1;this.Hg=this.Zo=this.connection=null;this.kl={};this.fa=this.VN=null};ha.prototype.dZ=function(x){for(var aa=this,r=0;r<x.length;++r){var n=x[r];switch(n.at){case "create":this.kl[n.author]||(this.kl[n.author]=n.aName);this.mya(n);break;case "modify":this.fa.ks(n.xfdf).then(function(f){aa.fa.Ib(f[0])});
break;case "delete":n="<delete><id>".concat(n.aId,"</id></delete>"),this.fa.ks(n)}}};ha.prototype.mya=function(x){var aa=this;this.fa.ks(x.xfdf).then(function(r){r=r[0];r.authorId=x.author;aa.fa.Ib(r);aa.fa.trigger(qa.c.UPDATE_ANNOTATION_PERMISSION,[r])})};ha.prototype.Axa=function(x,aa,r){this.Zo&&this.Zo(x,aa,r)};ha.prototype.preloadAnnotations=function(x){this.addEventListener("webViewerServerAnnotationsEnabled",this.Axa.bind(this,x,"add",{imported:!1}),{once:!0})};ha.prototype.initiateCollaboration=
function(x,aa,r){var n=this;if(x){n.Hg=aa;n.fa=r.ma();r.addEventListener(qa.h.DOCUMENT_UNLOADED,function(){n.disableCollaboration()});n.qLa(x);var f=new XMLHttpRequest;f.addEventListener("load",function(){if(200===f.status&&0<f.responseText.length)try{var a=JSON.parse(f.responseText);n.connection=exports.da.EMa(Object(ja.k)(n.Hg,"blackbox/"),"annot");n.VN=a.id;n.kl[a.id]=a.user_name;n.fa.JX(a.id);n.connection.eQa(function(b){b.t&&b.t.startsWith("a_")&&b.data&&n.dZ(b.data)},function(){n.connection.send({t:"a_retrieve",
dId:x});n.trigger(ha.Events.WEBVIEWER_SERVER_ANNOTATIONS_ENABLED,[n.kl[a.id],n.VN])},function(){n.disableCollaboration()})}catch(b){Object(na.g)(b.message)}});f.open("GET",Object(ja.k)(this.Hg,"demo/SessionInfo.jsp"));f.withCredentials=!0;f.send();n.$na=!0;n.fa.Gca(function(a){return n.kl[a.Author]||a.Author})}else Object(na.g)("Document ID required for collaboration")};ha.prototype.disableCollaboration=function(){this.Zo&&(this.fa.removeEventListener(ka.a.Events.ANNOTATION_CHANGED,this.Zo),this.Zo=
null);this.connection&&this.connection.mu();this.fa&&this.fa.JX("Guest");this.init();this.trigger(ha.Events.WEBVIEWER_SERVER_ANNOTATIONS_DISABLED)};ha.prototype.qLa=function(x){var aa=this;this.Zo&&this.fa.removeEventListener(ka.a.Events.ANNOTATION_CHANGED,this.Zo);this.Zo=function(r,n,f){return Object(pa.b)(this,void 0,void 0,function(){var a,b,e,w,ba,y,ea,z,fa;return Object(pa.d)(this,function(ca){switch(ca.label){case 0:if(f.imported)return[2];a={t:"a_".concat(n),dId:x,annots:[]};return[4,aa.fa.B5()];
case 1:b=ca.aa();"delete"!==n&&(e=(new DOMParser).parseFromString(b,"text/xml"),w=new XMLSerializer);for(ba=0;ba<r.length;ba++)y=r[ba],z=ea=void 0,"add"===n?(ea=e.querySelector('[name="'.concat(y.Id,'"]')),z=w.serializeToString(ea),fa=null,y.InReplyTo&&(fa=aa.fa.bh(y.InReplyTo).authorId||"default"),a.annots.push({at:"create",aId:y.Id,author:aa.VN,aName:aa.kl[aa.VN],parent:fa,xfdf:"<add>".concat(z,"</add>")})):"modify"===n?(ea=e.querySelector('[name="'.concat(y.Id,'"]')),z=w.serializeToString(ea),
a.annots.push({at:"modify",aId:y.Id,xfdf:"<modify>".concat(z,"</modify>")})):"delete"===n&&a.annots.push({at:"delete",aId:y.Id});0<a.annots.length&&aa.connection.send(a);return[2]}})})}.bind(aa);this.fa.addEventListener(ka.a.Events.ANNOTATION_CHANGED,this.Zo)};ha.Events={WEBVIEWER_SERVER_ANNOTATIONS_ENABLED:"webViewerServerAnnotationsEnabled",WEBVIEWER_SERVER_ANNOTATIONS_DISABLED:"webViewerServerAnnotationsDisabled"};return ha}();Object(xa.a)(h);ta["default"]=h}}]);}).call(this || window)
